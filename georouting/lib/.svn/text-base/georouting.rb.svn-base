methods_for :dialplan do

	def is_cellphone(number)
		npa = number[0..2]
		nxx = number[3..5]
		block_id = number[6]

		npanxx = Npanxx.where(:NPA => npa, :NXX => nxx, :BLOCK_ID => 'A').first
		puts "LTYPE: #{npanxx.LTYPE}"
		if npanxx.LTYPE == "C"
			return true
		else
			return false
		end

	end

	def get_stores_by_zip(zipcode, route_id, radius)
		coordinates = Npanxx.where("ZIP='#{zipcode.to_s}' OR ZIP2='#{zipcode.to_s}' OR ZIP3='#{zipcode.to_s}' OR ZIP4='#{zipcode.to_s}'").first

		lat = coordinates.latitude
		lng = coordinates.longitude
		
		store = GeoOption.near([lat, lng], radius).first
		return store
		#puts store.to_json
	end

	def get_stores_in_npanxx(caller_id, route_id, radius)
		npa = caller_id[0..2]
		nxx = caller_id[3..5]
		puts "NPA: #{npa} --- NXX: #{nxx}"
		puts "RADIUS: #{radius}"
		coordinates = Npanxx.where(:NPA => npa, :NXX => nxx).first

		store = GeoOption.near([coordinates.latitude, coordinates.longitude], radius).first

		return store
	end

end
